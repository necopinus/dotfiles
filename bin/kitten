#!/usr/bin/env -S bash -l

# NOTE: Bash is called above as a login shell using the -l flag to force
# /etc/profile and ~/.profile to be read, since this script may get
# called by GUI processes where the full shell environment (including
# Homebrew's path) hasn't been initialized

set -e

if [[ -x $HOME/local/lib/kitty.app/bin/kitten ]]; then
	exec $HOME/local/lib/kitty.app/bin/kitten "$@"
else
	export OLD_PATH="$PATH"
	export PATH="$(echo ":$PATH:" | sed "s#:$HOME/bin:#:#g;s#:$HOME/local/bin:#:#g;s#:$HOME/.local/bin:#:#g;s#^:##;s#:\$##")"

	KITTY_EXE="$(which kitty 2> /dev/null)"
	KITTEN_EXE="$(which kitten 2> /dev/null)"

	export PATH="$OLD_PATH"
	unset OLD_PATH

	if [[ -n "$KITTEN_EXE" ]]; then
		exec "$KITTEN_EXE" "$@"
	elif [[ -n "$KITTY_EXE" ]]; then
		exec "$KITTY_EXE" +kitten "$@"
	else
		echo "Could not locate kitten!"
		exit 1
	fi
fi
