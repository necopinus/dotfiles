#!/usr/bin/env -S bash -l

# NOTE: Bash is called above as a login shell using the -l flag to force
# /etc/profile and ~/.profile to be read, since this script may get
# called by GUI processes where the full shell environment (including
# Homebrew's path) hasn't been initialized

# TODO: This is not very well tested...

set -e

# Sanity-check input
# 
if [[ -d "$1" ]]; then
	DIR="$(realpath "$1")"
else
	DIR="$(realpath -- "$(dirname -- "$1")")"
	if [[ ! -d "$DIR" ]]; then
		echo "Provided path does not appear to map to a valid directory!"
		exit 1
	fi
fi

# Actual flow control is not that exciting
#
if [[ -n "$DISPLAY" ]] || [[ -n "$WAYLAND_DISPLAY" ]] || [[ "$OS" == "macos" ]]; then
	kitty -d "$DIR" &
	disown
else
	echo "Run the following command:"
	echo "    cd \"$DIR\""
fi
