#!/usr/bin/env -S bash -l

# NOTE: Bash is called above as a login shell using the -l flag to force
# /etc/profile and ~/.profile to be read, since this script may get
# called by GUI processes where the full shell environment (including
# Homebrew's path) hasn't been initialized

set -e

if [[ "$OS" == "macos" ]]; then
	OLD_PATH="$PATH"
	export PATH="$(echo ":$PATH:" | sed "s#:$HOME/bin:#:#g;s#:$HOME/local/bin:#:#g;s#:$HOME/.local/bin:#:#g;s#^:##;#:\$##")"

	PBPASTE_BIN="$(which pbpaste)"

	export PATH="$OLD_PATH"
	unset OLD_PATH

	exec "$PBPASTE_BIN" "@"
elif [[ "$OS" == "linux" ]] && [[ -n "$WAYLAND_DISPLAY" ]]; then
	exec wl-paste "@"
elif [[ "$OS" == "linux" ]] && [[ -n "$DISPLAY" ]]; then
	exec xsel -o -b "@"
fi
