#!/usr/bin/env -S bash -l

# Wrapper to make sure that fish always sees the environment set up in
# ~/.profile (calling bash above as a login shell using the -l flag
# forces /etc/profile and ~/.profile to be read)

set -e

# We can't call `fish` directly, because this wrapper needs to exist
# before the *actual* fish binary in the path; however, since we know 
# that ~/.profile has been sourced (see above), HOMEBREW_PREFIX is
# available, and we can exec fish from there (or just user PREFIX on
# Termux)
#
# NOTE: We *cannot* use `exec` here, as doing so leads to weird  "OPTION
#       ttyname=not a tty" errors with gpg-agent!
#
if [[ "$FLAVOR" == "termux" ]]; then
	$PREFIX/bin/fish -l "$@"
else
	$HOMEBREW_PREFIX/bin/fish -l "$@"
fi
